# P&ID管道数据提取工具

一个用于从P&ID图纸中自动提取管道号信息并生成Excel报告的工具。

## ✨ 功能特点

- 🔍 **自动识别管道号** - 从DWG文件中智能识别管道号格式
- 📊 **Excel报告生成** - 生成包含管道详细信息的Excel报告
- 🧪 **智能相态判断** - 基于介质名称自动判断液相/气相
- 🎯 **增强用户界面** - 现代化图形界面，支持多种文件输入方式
- 🖱️ **拖拽功能** - 支持直接拖拽文件到对应区域，带视觉反馈
- 📋 **最近文件** - 记住最近使用的5个文件，快速选择
- 📝 **自定义介质代码** - 支持从Excel文件加载介质代码映射
- 🔄 **实时进度显示** - 处理过程可视化
- ✅ **文件类型验证** - 智能识别文件类型，防止错误输入

## 📋 系统要求

- Windows 操作系统
- 已安装 AutoCAD（用于读取DWG文件）
- Python 3.9+ （开发环境）

## 🚀 快速开始

### 方式一：使用预编译版本（推荐）

1. 下载最新的 [Release](../../releases) 版本
2. 解压后运行 `PID_Extractor.exe`
3. 按照界面提示选择文件并开始提取

### 方式二：从源码运行

1. 克隆仓库
```bash
git clone https://github.com/your-username/CAD2EXL.git
cd CAD2EXL
```

2. 安装依赖
```bash
pip install -r requirements.txt
```

3. 运行程序
```bash
python pid_extractor_gui.py
```

## 📖 使用说明

### 1. 准备文件

- **DWG文件**: P&ID图纸文件
- **介质代码文件**: Excel文件，包含介质代码和名称的映射关系
  - 第一列：介质代码（如：BR、BRC、BP等）
  - 第二列：介质名称（如：锅炉水、锅炉给水等）

### 2. 操作步骤

1. 启动程序
2. **选择文件** - 支持三种方式：
   - 🖱️ **拖拽方式**：直接将文件拖拽到对应的输入框区域
   - 📋 **最近文件**：从下拉菜单中选择最近使用的文件
   - 📁 **浏览按钮**：传统的文件选择对话框
3. 选择DWG文件（自动识别.dwg格式）
4. 选择介质代码Excel文件（自动识别.xlsx/.xls格式）
5. 指定输出文件位置
6. 点击"开始提取"
7. 等待处理完成

💡 **小贴士**：拖拽文件时会有视觉反馈 - 蓝色表示可拖放，绿色表示成功，红色表示文件格式错误

### 3. 输出结果

生成的Excel文件包含以下信息：
- 管道号
- 管径
- 管道等级
- 保温型式
- 介质名称
- 相态

## 🛠️ 开发

### 项目结构

```
CAD2EXL/
├── pid_extractor_gui.py      # GUI版本主程序
├── pid_extractor.spec        # PyInstaller打包配置
├── requirements.txt          # Python依赖
├── CLAUDE.md                 # 项目开发文档
├── test/
│   ├── code.xlsx            # 测试用介质代码文件
│   └── test.dwg             # 测试DWG文件
└── dist/                    # 发布文件（打包后生成）
    ├── PID_Extractor.exe
    ├── 介质代码示例.xlsx
    └── 使用说明.txt
```

### 技术栈

- **界面**: tkinter (Python标准库) + tkinterdnd2 (拖拽支持)
- **数据处理**: pandas, openpyxl
- **AutoCAD接口**: pyautocad
- **打包**: PyInstaller

### 🎨 界面特色

#### 📂 智能文件选择
- **可视化拖拽区域**: 每个文件输入都有带边框的拖拽区域
- **文件格式验证**: 自动检查文件扩展名，只接受正确格式
- **视觉反馈系统**: 
  - 蓝色高亮 = 可拖放区域
  - 绿色闪烁 = 文件接受成功  
  - 红色闪烁 = 文件格式错误

#### 📋 便捷功能
- **最近文件记忆**: 每种文件类型记住最近5个使用的文件
- **智能目录定位**: 文件对话框自动打开到最近使用的目录
- **多种输入方式**: 拖拽、下拉选择、传统浏览按钮并存

### 构建可执行文件

```bash
# 安装打包工具
pip install pyinstaller

# 打包
pyinstaller pid_extractor.spec
```

### 主要依赖

- pandas>=1.5.0 - 数据处理
- openpyxl>=3.0.0 - Excel文件读写
- pyautocad>=0.2.0 - AutoCAD COM接口
- tkinterdnd2>=0.4.0 - 拖拽功能支持
- Pillow>=9.0.0 - 图像处理（Logo显示）
- comtypes - Windows COM组件

## 📄 管道号格式

工具支持以下管道号格式：
```
装置号-管径-介质代码-管道号-管道等级-保温型式
示例: 1001-100-BR-123456A-C1C-A
```

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📝 许可证

MIT License

## 📞 支持

如果您遇到问题，请：
1. 查看使用说明文件
2. 检查系统要求是否满足
3. 提交Issue描述问题

## 🔄 版本历史

查看 [CHANGELOG.md](CHANGELOG.md) 了解详细的版本更新记录。

---

⚡ 由 [Claude Code](https://claude.ai/code) 协助开发